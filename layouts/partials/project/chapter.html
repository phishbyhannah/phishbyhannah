{{ $chapter := . }}
{{ range $idx, $block := $chapter.Params.blocks }}
  {{ if eq $block.type "divider" }}
  <section class="post-holder{{ if modBool $idx 2 }} light{{ else }} dark{{ end }} project-divider-holder">
    <article class="post project-divider-post">
      <header class="post-header">
        <h2 class="post-title">{{ $block.title }}</h2>
      </header>
      <section class="post-content project-divider-sub">
        {{ range $block.subtitle_lines }}<p>{{ . }}</p>{{ end }}
      </section>
    </article>
  </section>
  {{ end }}

  {{ if eq $block.type "fullbleed" }}
  {{ $img := "" }}
  {{ with $block.image }}
    {{ with $chapter.Resources.GetMatch . }}
      {{ $img = .RelPermalink }}
    {{ else }}
      {{ $img = . }}
    {{ end }}
  {{ end }}
  <section class="post-holder dark project-fullbleed-holder">
    <figure class="project-fullbleed-figure">
      {{ partial "media/responsive_image.html" (dict "src" $img "alt" $block.alt "loading" "lazy" "sizes" "100vw" "fallbackWidth" 1600) }}
      {{ with $block.caption }}<figcaption>{{ . }}</figcaption>{{ end }}
    </figure>
  </section>
  {{ end }}

  {{ if eq $block.type "stagger2" }}
  {{ $left := "" }}
  {{ with $block.left_image }}
    {{ with $chapter.Resources.GetMatch . }}
      {{ $left = .RelPermalink }}
    {{ else }}
      {{ $left = . }}
    {{ end }}
  {{ end }}
  {{ $right := "" }}
  {{ with $block.right_image }}
    {{ with $chapter.Resources.GetMatch . }}
      {{ $right = .RelPermalink }}
    {{ else }}
      {{ $right = . }}
    {{ end }}
  {{ end }}
  <section class="post-holder light project-stagger-holder">
    <div class="project-stagger-grid">
      <figure class="project-stagger-item project-stagger-left">
        {{ partial "media/responsive_image.html" (dict "src" $left "alt" $block.left_alt "loading" "lazy" "sizes" "(max-width: 900px) 100vw, 50vw" "fallbackWidth" 1200) }}
      </figure>
      <figure class="project-stagger-item project-stagger-right">
        {{ partial "media/responsive_image.html" (dict "src" $right "alt" $block.right_alt "loading" "lazy" "sizes" "(max-width: 900px) 100vw, 50vw" "fallbackWidth" 1200) }}
      </figure>
    </div>
  </section>
  {{ end }}

  {{ if eq $block.type "grid3" }}
  <section class="post-holder dark project-grid-holder">
    <div class="project-grid3">
      {{ range $block.images }}
      {{ $grid := "" }}
      {{ with .image }}
        {{ with $chapter.Resources.GetMatch . }}
          {{ $grid = .RelPermalink }}
        {{ else }}
          {{ $grid = . }}
        {{ end }}
      {{ end }}
      <figure class="project-grid3-item">
        {{ partial "media/responsive_image.html" (dict "src" $grid "alt" .alt "loading" "lazy" "sizes" "(max-width: 900px) 100vw, 33vw" "fallbackWidth" 1080) }}
      </figure>
      {{ end }}
    </div>
  </section>
  {{ end }}

  {{ if eq $block.type "breath" }}
  {{ $breath := "" }}
  {{ with $block.image }}
    {{ with $chapter.Resources.GetMatch . }}
      {{ $breath = .RelPermalink }}
    {{ else }}
      {{ $breath = . }}
    {{ end }}
  {{ end }}
  <section class="post-holder{{ if eq $block.style "small" }} light{{ else }} dark{{ end }} project-breath-holder project-breath-{{ $block.style }}">
    {{ if eq $block.style "small" }}
    <figure class="project-breath-small">
      {{ partial "media/responsive_image.html" (dict "src" $breath "alt" $block.alt "loading" "lazy" "sizes" "(max-width: 900px) 100vw, 60vw" "fallbackWidth" 1200) }}
    </figure>
    {{ end }}
  </section>
  {{ end }}
{{ end }}
